<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ROI Calculator</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700;800&display=swap" rel="stylesheet">
    
    <style>
        /* --- RESET & BASICS --- */
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { 
            font-family: 'Inter', sans-serif; 
            background-color: #000; 
            color: #e5e7eb; 
            display: flex; 
            justify-content: center; 
            padding: 20px; 
            min-height: 100vh;
        }
        
        /* --- LAYOUT --- */
        .container { width: 100%; max-width: 900px; margin: 0 auto; }
        .card { background-color: #101211; padding: 40px; border-radius: 12px; border: 1px solid #2d2d2d; box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04); position: relative; overflow: hidden; }
        
        /* --- TYPOGRAPHY --- */
        h2 { font-size: 2rem; font-weight: 700; color: white; margin-bottom: 1rem; text-align: center; }
        h3 { font-size: 1.5rem; font-weight: 700; color: white; margin-bottom: 1.5rem; }
        h4 { font-size: 1.125rem; font-weight: 700; color: white; margin-bottom: 0.5rem; }
        p { font-size: 0.875rem; color: #9CA3AF; line-height: 1.5; }
        .text-brand { color: #EDA400; }
        .text-red { color: #F87171; }
        .text-center { text-align: center; }
        .logo { height: 48px; width: auto; display: block; margin: 0 auto 1rem auto; }

        /* --- FORMS --- */
        .input-group { margin-bottom: 1rem; }
        label { display: block; font-size: 0.875rem; color: #9CA3AF; margin-bottom: 0.5rem; }
        input { 
            width: 100%; 
            background-color: #202221; 
            border: 1px solid #374151; 
            border-radius: 6px; 
            padding: 12px; 
            color: white; 
            font-size: 1rem; 
            outline: none;
            transition: border-color 0.2s;
        }
        input:focus { border-color: #EDA400; }
        .input-error { border-color: #F87171 !important; }
        .error-msg { color: #F87171; font-size: 0.75rem; margin-top: 0.25rem; display: none; }
        .show-error { display: block; }

        /* --- BUTTONS --- */
        .btn { 
            display: block; 
            width: 100%; 
            background-color: #EDA400; 
            color: #000; 
            font-weight: 700; 
            padding: 14px; 
            border-radius: 8px; 
            border: none; 
            cursor: pointer; 
            font-size: 1rem;
            transition: background-color 0.2s;
            text-align: center;
            text-decoration: none;
        }
        .btn:hover { background-color: #d59200; }
        .btn-secondary { background-color: #374151; color: white; }
        .btn-secondary:hover { background-color: #4B5563; }
        .btn-row { display: flex; gap: 1rem; margin-top: 1.5rem; }
        .w-30 { width: 30%; }
        .w-70 { width: 70%; }

        /* --- GRID --- */
        .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; }
        @media (max-width: 640px) { .grid-2 { grid-template-columns: 1fr; } }
        .col-span-2 { grid-column: span 2; }
        @media (max-width: 640px) { .col-span-2 { grid-column: span 1; } }

        /* --- INFO BOX --- */
        .info-box { background-color: #202221; border: 1px solid #374151; border-radius: 8px; padding: 1rem; margin-bottom: 1.5rem; }

        /* --- STEPS & VISIBILITY --- */
        .step-section { display: none; animation: fadeIn 0.4s ease-out; }
        .step-active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
        
        /* --- LOADER --- */
        #loadingOverlay { 
            position: fixed; inset: 0; background: rgba(0,0,0,0.85); 
            display: flex; flex-direction: column; align-items: center; justify-content: center; 
            z-index: 50; opacity: 0; pointer-events: none; transition: opacity 0.3s;
        }
        #loadingOverlay.active { opacity: 1; pointer-events: all; }
        .spinner { border: 4px solid #374151; border-top: 4px solid #EDA400; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* --- GRAPHS --- */
        .graph-container { margin-bottom: 2rem; }
        .bar-header { display: flex; justify-content: space-between; font-size: 0.875rem; margin-bottom: 0.5rem; }
        .bar-track { background-color: #101211; height: 2rem; width: 100%; border-radius: 6px; position: relative; display: flex; overflow: hidden; }
        .bar-segment { height: 100%; width: 0%; transition: width 1s ease-out; }
        
        /* Colors */
        .bg-loss { background-color: #F87171; }
        .bg-gray { background-color: #6B7280; }
        .bg-base { background-color: #D1D5DB; }
        .bg-uplift { background-color: #FDE68A; }
        .bg-data { background-color: #EDA400; }

        .breakeven-line { position: absolute; top: -4px; bottom: -4px; width: 2px; background-color: #EDA400; z-index: 10; opacity: 0.8; }
        .breakeven-label { position: absolute; top: -18px; transform: translateX(-50%); font-size: 10px; color: #EDA400; font-weight: 700; }
        
        .legend { display: flex; flex-wrap: wrap; justify-content: center; gap: 1rem; margin-bottom: 1rem; font-size: 0.75rem; color: #9CA3AF; }
        .dot { width: 10px; height: 10px; border-radius: 50%; display: inline-block; margin-right: 6px; }

        /* --- RESULTS BOXES --- */
        .results-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; margin-top: 2rem; }
        @media (max-width: 768px) { .results-grid { grid-template-columns: 1fr; } }
        .result-card { background-color: #202221; border: 1px solid #374151; border-radius: 8px; padding: 1.5rem; }
        .result-card.highlight { border: 2px solid #EDA400; }
        .res-row { display: flex; justify-content: space-between; font-size: 0.875rem; margin-bottom: 0.5rem; }
        .border-t { border-top: 1px solid #374151; margin-top: 1rem; padding-top: 1rem; }
    </style>
</head>
<body>

    <div id="loadingOverlay">
        <div class="spinner"></div>
        <p style="color: white; margin-top: 1rem; font-weight: 600;">Calculating results...</p>
    </div>

    <div class="container">
        <div class="text-center">
            <img src="https://cdn.prod.website-files.com/68cc5af3d01de0e204120944/68d407d3bf013b181b7bd083_36k-logo-whte-yllw.avif" alt="Threesixkey Logo" class="logo">
            <h2><span class="text-brand">Buy, Scan, Win</span> ROI Calculator</h2>
        </div>

        <div class="card">
            
            <div id="step1" class="step-section step-active">
                <div class="info-box">
                    <h4 class="text-brand">What is this tool?</h4>
                    <p>Compare your current "Cost Center" campaigns against a "Revenue Generating" Full-Stack system.</p>
                </div>
                
                <h3>Step 1: Program Investment</h3>
                <div class="input-group">
                    <label>Strategy, Creative & Tech Build ($)</label>
                    <input type="number" id="techFees" value="15000">
                </div>
                <div class="input-group">
                    <label>Media & Acquisition Spend ($)</label>
                    <input type="number" id="mediaSpend" value="5000">
                </div>
                <div class="input-group">
                    <label>Prize Pool & Fulfillment ($)</label>
                    <input type="number" id="prizeCosts" value="10000">
                </div>
                <div id="step1Error" class="error-msg">Please enter valid amounts greater than 0.</div>
                
                <button onclick="goToStep('step2')" class="btn" style="margin-top: 1.5rem;">Next: Enter Results &rarr;</button>
            </div>

            <div id="step2" class="step-section">
                <h3>Step 2: Performance Metrics</h3>
                <div class="grid-2">
                    <div class="input-group">
                        <label>Total Participants</label>
                        <input type="number" id="participants" value="5000">
                    </div>
                    <div class="input-group">
                        <label>Leads Collected (Emails)</label>
                        <input type="number" id="leads" value="5000">
                    </div>
                    <div class="input-group">
                        <label>Product Unit Price ($)</label>
                        <input type="number" id="productPrice" value="5">
                    </div>
                    <div class="input-group">
                        <label>Avg. Units per Receipt</label>
                        <input type="number" id="avgUnits" value="1">
                    </div>
                    <div class="input-group col-span-2">
                        <label>Target Units per Receipt (Gamified)</label>
                        <input type="number" id="targetAvgUnits" value="1.5">
                    </div>
                </div>
                <div id="step2Error" class="error-msg" style="margin-bottom: 1rem;">Please check your inputs.</div>
                
                <div class="btn-row">
                    <button onclick="goToStep('step1')" class="btn btn-secondary w-30">&larr; Back</button>
                    <button onclick="goToStep('stepEmail')" class="btn w-70">Calculate ROI &rarr;</button>
                </div>
            </div>

            <div id="stepEmail" class="step-section">
                <div class="text-center" style="padding: 2rem 0;">
                    <h3>Unlock Your Analysis</h3>
                    <p style="margin-bottom: 1.5rem;">Enter your email to see the 2 critical value sources you are missing.</p>
                    
                    <div style="max-width: 400px; margin: 0 auto;">
                        <input type="email" id="userEmail" placeholder="you@company.com">
                        <div id="emailError" class="error-msg">Please enter a valid email address.</div>
                        <button onclick="submitAndCalc()" class="btn" style="margin-top: 1rem;">Unlock Results &rarr;</button>
                    </div>
                    
                    <button onclick="goToStep('step2')" style="background:none; border:none; color:#6B7280; margin-top: 1rem; cursor:pointer;">Go Back</button>
                </div>
            </div>

            <div id="stepResult" class="step-section">
                <h3 class="text-center">Your ROI Analysis</h3>

                <div class="legend">
                    <div><span class="dot bg-loss"></span>Loss</div>
                    <div><span class="dot bg-base"></span>Baseline</div>
                    <div><span class="dot bg-uplift"></span>Uplift</div>
                    <div><span class="dot bg-data"></span>Data Value</div>
                </div>

                <div class="graph-container">
                    <div class="bar-header">
                        <span style="color: #9CA3AF;">Standard Program ROI</span>
                        <span id="disp-trad-val" style="color: white; font-weight: bold;"></span>
                    </div>
                    <div class="bar-track" id="track-trad">
                        <div id="bar-trad" class="bar-segment bg-gray"></div>
                    </div>
                    
                    <div class="bar-header" style="margin-top: 1.5rem;">
                        <span class="text-brand" style="font-weight: bold;">Full-Stack ROI</span>
                        <span id="disp-fs-val" class="text-brand" style="font-weight: bold;"></span>
                    </div>
                    <div class="bar-track" id="track-fs">
                        <div id="bar-fs-base" class="bar-segment bg-base"></div>
                        <div id="bar-fs-uplift" class="bar-segment bg-uplift"></div>
                        <div id="bar-fs-data" class="bar-segment bg-data"></div>
                    </div>
                </div>

                <div class="results-grid">
                    <div class="result-card">
                        <h4>The Standard View</h4>
                        <p style="font-size: 0.8rem; margin-bottom: 1rem;">You spent <span id="txt-inv" style="color: white;"></span> to generate <span id="txt-base-rev" style="color: white;"></span>.</p>
                        <div class="border-t">
                            <div class="res-row">
                                <span>Baseline ROI</span>
                                <span id="txt-base-roi" class="text-red" style="font-weight: bold;"></span>
                            </div>
                        </div>
                    </div>

                    <div class="result-card highlight">
                        <h4 class="text-brand">The Full-Stack View</h4>
                        <p style="font-size: 0.8rem; margin-bottom: 1rem;">Gamification added <span id="txt-uplift" style="color: white;"></span> sales + <span id="txt-data" style="color: white;"></span> data value.</p>
                        <div class="border-t">
                            <div class="res-row">
                                <span style="color: #9CA3AF;">Total Value</span>
                                <span id="txt-total" style="color: white; font-weight: bold;"></span>
                            </div>
                            <div class="res-row">
                                <span class="text-brand">Real ROI</span>
                                <span id="txt-real-roi" class="text-brand" style="font-weight: bold;"></span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="text-center" style="margin-top: 3rem;">
                    <a href="https://www.threesixkey.com/contact-us" target="_top" class="btn" style="display: inline-block; width: auto; padding: 1rem 2rem;">Book a 15-Min Demo to Plug Your Data Leaks</a>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- LOGIC ---
        function getVal(id) { return parseFloat(document.getElementById(id).value) || 0; }
        function setTxt(id, txt) { const el = document.getElementById(id); if(el) el.innerText = txt; }
        function fmtMoney(n) { return n.toLocaleString('en-US', {style:'currency', currency:'USD', maximumFractionDigits:0}); }
        function fmtPct(n) { return n.toLocaleString('en-US', {style:'percent', maximumFractionDigits:0}); }

        function goToStep(stepId) {
            // Validation
            document.querySelectorAll('.error-msg').forEach(e => e.style.display = 'none');
            
            if (stepId === 'step2') {
                if (getVal('techFees') <= 0 || getVal('mediaSpend') <= 0) {
                    document.getElementById('step1Error').style.display = 'block'; return;
                }
            }
            if (stepId === 'stepEmail') {
                if (getVal('participants') <= 0 || getVal('productPrice') <= 0) {
                    document.getElementById('step2Error').style.display = 'block'; return;
                }
            }

            // Switch steps
            document.querySelectorAll('.step-section').forEach(el => el.classList.remove('step-active'));
            document.getElementById(stepId).classList.add('step-active');

            // Resize Signal for Iframe
            setTimeout(() => {
                const height = document.body.scrollHeight;
                window.parent.postMessage({ type: 'resize', height: height }, '*');
            }, 100);
        }

        function submitAndCalc() {
            const email = document.getElementById('userEmail').value;
            if (!email.includes('@') || !email.includes('.')) {
                document.getElementById('emailError').style.display = 'block'; return;
            }

            // Webhook
            fetch('https://n8n.hatim.us/webhook/37dea748-679c-4871-ac9a-0108ffec901f', {
                method: 'POST', mode: 'no-cors', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({email})
            });

            const overlay = document.getElementById('loadingOverlay');
            overlay.classList.add('active');

            setTimeout(() => {
                calculate();
                overlay.classList.remove('active');
                goToStep('stepResult');
            }, 2000);
        }

        function calculate() {
            // 1. Get Inputs
            const tech = getVal('techFees');
            const media = getVal('mediaSpend');
            const prize = getVal('prizeCosts');
            const parts = getVal('participants');
            const leads = getVal('leads') || parts;
            const price = getVal('productPrice');
            const avg = getVal('avgUnits');
            const target = getVal('targetAvgUnits');

            // 2. Math
            const investment = tech + media + prize;
            
            const baseRev = parts * avg * price;
            const baseROI = (baseRev - investment) / investment;
            const baseROAS = baseRev / investment;

            const targetRev = parts * target * price;
            const uplift = targetRev - baseRev;
            const dataVal = leads * 10; // $10 benchmark
            const totalVal = targetRev + dataVal;
            const fullROI = (totalVal - investment) / investment;
            const fullROAS = totalVal / investment;

            // 3. Update Text
            setTxt('disp-trad-val', fmtPct(baseROI));
            setTxt('disp-fs-val', fmtPct(fullROI));

            setTxt('txt-inv', fmtMoney(investment));
            setTxt('txt-base-rev', fmtMoney(baseRev));
            setTxt('txt-base-roi', fmtPct(baseROI));

            setTxt('txt-uplift', fmtMoney(uplift));
            setTxt('txt-data', fmtMoney(dataVal));
            setTxt('txt-total', fmtMoney(totalVal));
            setTxt('txt-real-roi', fmtPct(fullROI));

            // 4. Draw Graphs
            // Calculate max scale
            const maxROAS = Math.max(1.2, fullROAS); // Ensure at least 1.2x scale
            const breakEvenPct = (1 / maxROAS) * 100;

            // Draw Breakeven Lines
            ['track-trad', 'track-fs'].forEach(id => {
                const track = document.getElementById(id);
                // Clear old lines
                track.querySelectorAll('.breakeven-line, .breakeven-label').forEach(e => e.remove());
                
                const line = document.createElement('div');
                line.className = 'breakeven-line';
                line.style.left = breakEvenPct + '%';
                
                const label = document.createElement('div');
                label.className = 'breakeven-label';
                label.style.left = breakEvenPct + '%';
                label.innerText = 'Breakeven';

                track.appendChild(line);
                track.appendChild(label);
            });

            // Set Bar Widths
            const tradWidth = (baseROAS / maxROAS) * 100;
            const barTrad = document.getElementById('bar-trad');
            barTrad.style.width = tradWidth + '%';
            barTrad.className = 'bar-segment ' + (baseROAS < 1 ? 'bg-loss' : 'bg-gray');

            const baseWidth = ((baseRev / investment) / maxROAS) * 100;
            const upliftWidth = ((uplift / investment) / maxROAS) * 100;
            const dataWidth = ((dataVal / investment) / maxROAS) * 100;

            setTimeout(() => document.getElementById('bar-fs-base').style.width = baseWidth + '%', 200);
            setTimeout(() => document.getElementById('bar-fs-uplift').style.width = upliftWidth + '%', 600);
            setTimeout(() => document.getElementById('bar-fs-data').style.width = dataWidth + '%', 1000);
        }
    </script>
</body>
</html>
